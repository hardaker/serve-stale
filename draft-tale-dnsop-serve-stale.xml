<?xml version="1.0" encoding="us-ascii"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.40 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC1035 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.1035.xml">
<!ENTITY RFC2181 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2181.xml">
<!ENTITY RFC2119 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC7719 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7719.xml">
]>

<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>

<rfc ipr="trust200902" docName="draft-tale-dnsop-serve-stale-00" category="std">

  <front>
    <title>Serving Stale Data to Improve DNS Resiliency</title>

    <author initials="D.C." surname="Lawrence" fullname="David C Lawrence">
      <organization>Akamai Technologies</organization>
      <address>
        <postal>
          <street>150 Broadway</street>
          <city>Cambridge</city>
          <code>MA 02142-1054</code>
          <country>USA</country>
        </postal>
        <email>tale@akamai.com</email>
      </address>
    </author>
    <author initials="W." surname="Kumari" fullname="Warren Kumari">
      <organization>Google</organization>
      <address>
        <postal>
          <street>1600 Amphitheatre Parkway</street>
          <city>Mountain View</city>
          <code>CA 94043</code>
          <country>USA</country>
        </postal>
        <email>warren@kumari.net</email>
      </address>
    </author>

    <date year="2017" month="February"/>

    <area>Internet</area>
    <workgroup>DNSOP Working Group</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This draft defines a method for recursive resolvers to use stale DNS
data to avoid outages when authoritative nameservers cannot be reached
to refresh expired data.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>Traditionally the Time To Live (TTL) of a DNS resource record has been
understood to represent the maximum number of seconds that a record
can be used before it must be discarded, based on its description and
usage in <xref target="RFC1035"/> and clarifications in <xref target="RFC2181"/>.
Specifically, <xref target="RFC1035"/> Section 3.2.1 says that it, "specifies the
time interval that the resource record may be cached before the source
of the information should again be consulted".</t>

<t>Notably, the original DNS specification does not say that data past
its expiration cannot be used.  This document proposes a method for
how recursive resolvers should handle stale DNS data to balance the
competing needs of resiiency and strict correctness. It is predicated
on the observation that authoritative server unavailability can cause
outages even when the underlying data those servers would return is
typically unchanged.</t>

<t>Several major recursive resolver operations currently use stale data
for answers in some way, including Akamai, OpenDNS, Xerocole, and
Google (I think).</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <xref target="RFC2119"/></t>

<t>For a comprehensive treatment of DNS terms, please see <xref target="RFC7719"/>.</t>

</section>
<section anchor="description" title="Description">

<t>Three notable timers drive considerations for the use of stale data,
as follows:</t>

<t><list style="symbols">
  <t>A client response timer, which is the maximum amount of time a
recursive resolver should allow between the receipt of a resolution
request and sending its response.</t>
  <t>A query resolution timer, which caps the total amount of time a
recursive resolver spends processing the query.</t>
  <t>A maximum stale timer, which caps the amount of time
that records will be kept past their expiration.</t>
</list></t>

<t>Recursive resolvers already have that second timer; the first and
third timers are new concepts for this mechanism.</t>

<t>When a request is received by the recursive resolver, it SHOULD start
the client response timer.  This timer is used to avoid client
timeouts.  It SHOULD be configurable, with a recommended value of 1.8
seconds.</t>

<t>The resolver then checks its cache for an unexpired answer. If it
finds none and the Recursion Desired flag is not set in the request,
it SHOULD immediately return the response without consulting the
expired record cache.</t>

<t>If iterative lookups will be done, it SHOULD start the query
resolution timer.  This timer bounds the work done by the resolver,
and is commonly 30 seconds.</t>

<t>If the answer has not been completely determined when the client
response timer has elapsed, the resolver SHOULD then check its cache
to see whether there is expired data that would satisfy the request.
If so, it sends a response and the TTL fields of the expired records
SHOULD be set to 1.</t>

<t>Orthogonal to the query resolution process, the maximum stale timer is
used for cache management.  This timer is conceptually different from
the maximum cache TTL that exists in many resolvers, the latter of
which is a clamp on the value of TTLs as received from authoritative
servers.  The maximum stale timer SHOULD be configurable, and
defines the length of time after a record expires that it SHOULD be
retained in the cache.  The suggested value is 7 days, which gives
time to notice the problem and and for human intervation for fixing
it,</t>

</section>
<section anchor="implementation-caveats" title="Implementation Caveats">

<t>Note well that answers from authoritive servers that have a DNS
Response Code of either 0 (NOERROR) or 3 (NXDOMAIN) MUST be considered
to have refreshed the data.  In particular, this means that this
method is not meant to protect against operator error at the
authoritative server that turns a name that is intended to be valid
into one that is non-existent, because there is no way for a resolver
to know intent.</t>

<t>It is important to continue the resolution attempt after the stale
response has been sent because some pathological resolutions can take
at least a dozen seconds to be successful as they fall back from down
servers, bad networks, and other problems.  Stopping the resolution
just because the response has been sent would mean that answers in
these pathological cases would never be refreshed.</t>

<t>Canonical Name (CNAME) records mingled in the expired cache with other
records at the same owner name can cause surprising results.  This was
observed with an initial implementation in BIND, where a hostname
changed first from having a CNAME record to an IPv4 Address (A)
record.  BIND does not evict CNAMEs in the cache when other types are
received, which in normal operations is not an issue.  However, after
both records expired and the authorities became unavailable, the
fallback to stale answers returned the older CNAME instead of the
newer A.</t>

<t>(This might apply to other occluding types, so more though should be
given to the overall issue.)</t>

<t>Keeping records around after their normal expiration will of course
cause caches to grow larger than if records were removed at their TTL.
Specific guidance about how to manage cache sizes is outside the scope
of this document.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

<t>The most obvious security issue is the increased likelihood of DNSSEC
validation failures when using stale data because signatures could be
returned outside their validity period.</t>

<t>Additionally, bad actors have been known to use DNS caches as sort of
a perpetual cloud database, keeping records alive even after their
authorities have gone away.  This makes that easier.</t>

</section>
<section anchor="privacy-considerations" title="Privacy Considerations">

<t>This document does not add any practical new privacy issues.</t>

</section>
<section anchor="nat-considerations" title="NAT Considerations">

<t>The method described here is not affected by the use of NAT devices.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>This document contains no actions for IANA.</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

<t>The authors wish to thank &#8230;</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC1035;
&RFC2181;
&RFC2119;
&RFC7719;


    </references>




  </back>

<!-- ##markdown-source:
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

-->

</rfc>

